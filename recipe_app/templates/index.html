{% extends "base.html" %}

{% block title %}Alle Rezepte - Cooked Together{% endblock %}

{% block content %}
<div class="index-page">
    <!-- Suchleiste -->
    <div class="search-section">
        <form action="{{ url_for('index') }}" method="get" class="search-form">
            <input
                type="text"
                name="search"
                placeholder="üîç Rezepte durchsuchen..."
                value="{{ search_term }}"
                class="search-input"
            >
            <button type="submit" class="btn btn-primary">Suchen</button>
        </form>

        {% if search_term %}
            <div class="search-info">
                Suche nach: <strong>{{ search_term }}</strong>
                <a href="{{ url_for('index') }}" class="clear-search">‚úï Zur√ºcksetzen</a>
            </div>
        {% endif %}
    </div>

    <!-- Tag-Filter Pills -->
    {% if all_tags %}
    <div class="tag-filter-section">
        <h3>Filter nach Kategorie: {% if selected_tags %}<small>({{ selected_tags|length }} ausgew√§hlt)</small>{% endif %}</h3>
        <div class="tag-pills">
            <a href="{{ url_for('index', search=search_term if search_term else '') }}"
               class="tag-pill {% if not selected_tags %}active{% endif %}">
                Alle
            </a>
            {% for tag in all_tags %}
                {% set is_selected = tag.name in selected_tags %}
                {% if is_selected %}
                    {# Tag entfernen wenn bereits ausgew√§hlt #}
                    {% set new_tags = selected_tags | reject('equalto', tag.name) | list %}
                {% else %}
                    {# Tag hinzuf√ºgen #}
                    {% set new_tags = selected_tags + [tag.name] %}
                {% endif %}
                <a href="{{ url_for('index', tags=new_tags|join(','), search=search_term if search_term else '') }}"
                   class="tag-pill {% if is_selected %}active{% endif %}">
                    {{ tag.name|capitalize }}
                    {% if is_selected %}‚úì{% endif %}
                </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Rezeptliste -->
    <div class="recipes-grid">
        {% if recipes %}
            {% for recipe in recipes %}
                <article class="recipe-card">
                    <a href="{{ url_for('view_recipe', recipe_id=recipe.id) }}" class="recipe-card-link">
                        <!-- Rezeptbild -->
                        {% if recipe.image_path %}
                            <div class="recipe-card-image">
                                <img src="{{ url_for('uploaded_file', filename=recipe.image_path) }}"
                                     alt="{{ recipe.title }}">
                            </div>
                        {% else %}
                            <div class="recipe-card-image recipe-card-image-placeholder">
                                <span class="placeholder-icon">üçΩÔ∏è</span>
                            </div>
                        {% endif %}

                        <!-- Rezeptinfo -->
                        <div class="recipe-card-content">
                            <h2 class="recipe-card-title">{{ recipe.title }}</h2>

                            {% if recipe.description %}
                                <p class="recipe-card-description">
                                    {{ recipe.description[:100] }}{% if recipe.description|length > 100 %}...{% endif %}
                                </p>
                            {% endif %}

                            <!-- Meta-Informationen -->
                            <div class="recipe-card-meta">
                                {% if recipe.prep_time_minutes or recipe.cook_time_minutes %}
                                    <span class="meta-item">
                                        ‚è±Ô∏è
                                        {% if recipe.prep_time_minutes %}{{ recipe.prep_time_minutes }} min Vorbereitung{% endif %}
                                        {% if recipe.prep_time_minutes and recipe.cook_time_minutes %} | {% endif %}
                                        {% if recipe.cook_time_minutes %}{{ recipe.cook_time_minutes }} min Kochen{% endif %}
                                    </span>
                                {% endif %}

                                <span class="meta-item">
                                    üë• {{ recipe.base_portions }} Portionen
                                </span>
                            </div>

                            <!-- Tags -->
                            {% set tags_list = recipe.tags.all() %}
                            {% if tags_list %}
                                <div class="recipe-card-tags">
                                    {% for tag in tags_list[:3] %}
                                        <span class="tag-badge">{{ tag.name }}</span>
                                    {% endfor %}
                                    {% if tags_list|length > 3 %}
                                        <span class="tag-badge">+{{ tags_list|length - 3 }}</span>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                </article>
            {% endfor %}
        {% else %}
            <div class="no-results">
                <p class="no-results-icon">üîç</p>
                <h2>Keine Rezepte gefunden</h2>
                {% if search_term or tag_filter %}
                    <p>Versuche es mit anderen Suchbegriffen oder <a href="{{ url_for('index') }}">zeige alle Rezepte</a>.</p>
                {% else %}
                    <p>Noch keine Rezepte vorhanden. <a href="{{ url_for('add_recipe') }}">F√ºge das erste Rezept hinzu!</a></p>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
